<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Add Property</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
   <link rel="stylesheet" href="../css/style.css">
</head>
<body>
   
<header class="header">
   <nav class="navbar nav-1">
      <section class="flex">
         <a href="dashboard.html" class="logo"><i class="fas fa-house"></i>MyHome </a>
      </section>
   </nav>

   <nav class="navbar nav-2">
      <section class="flex">
         <div id="menu-btn" class="fas fa-bars"></div>
         <div class="menu">
            <ul>
               <li><a href="dashboard.html">Dashboard</a></li>
            </ul>
         </div>
         <ul>
            <li><a href="profile.html"><i class="fas fa-user"></i> John Doe</a></li>
            <li><a href="../index.html"><i class="fas fa-sign-out"></i> Logout</a></li>
         </ul>
      </section>
   </nav>
</header>

<section class="form-container">
   <form id="addPropertyForm" method="post">
      <h3>Add New Property</h3>
      
      <!-- Boarding House Name -->
      <div class="box">
         <p>Boarding House Name <span>*</span></p>
         <input type="text" name="title" required maxlength="50" placeholder="Enter boarding house name" class="input">
      </div>

      <!-- Address -->
      <div class="box">
         <p>Address <span>*</span></p>
         <input type="text" name="address" required placeholder="Enter full address" class="input">
      </div>

      <!-- Property Type & Price -->
      <div class="flex">
         <div class="box" style="flex: 1;">
            <p>Property Type <span>*</span></p>
            <select name="room_type" class="input" required>
               <option value="Studio Type">Studio Type</option>
               <option value="Bed Spacer">Bed Spacer</option>
            </select>
         <!-- Price per Month -->
<div class="box" style="flex: 1;">
    <p>Price per Month <span>*</span></p>
    <input type="text" name="price" required pattern="[0-9]*" placeholder="Enter price" class="input" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
</div>

<!-- Number of Beds -->
<div class="box">
    <p>Number of Beds</p>
    <input type="text" name="beds" pattern="[0-9]*" placeholder="Enter number of beds" class="input" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
</div>

      <!-- Capacity -->
      <div class="box">
         <p>Capacity <span>*</span></p>
         <select name="capacity" class="input" required>
            <option value="1">1 person</option>
            <option value="2-4">2-4 persons</option>
            <option value="4-5">4-5 persons</option>
            <option value="5+">5+ persons</option>
         </select>
      </div>

      <!-- Contact Phone -->
      <div class="box">
         <p>Contact Phone Number</p>
         <input type="tel" name="contact_phone" placeholder="Enter contact number" class="input">
      </div>

      <!-- Description -->
      <div class="box">
         <p>Description</p>
         <textarea name="description" placeholder="Enter property description" class="input" style="height: 10rem;"></textarea>
      </div>

      <!-- Amenities -->
      <div class="box">
         <p>Amenities</p>
         <div class="amenities-grid">
            <label class="amenity-option">
               <input type="checkbox" name="amenities" value="wifi"> 
               <span>WiFi</span>
            </label>
            <label class="amenity-option">
               <input type="checkbox" name="amenities" value="parking"> 
               <span>Parking</span>
            </label>
            <label class="amenity-option">
               <input type="checkbox" name="amenities" value="cctv"> 
               <span>CCTV</span>
            </label>
            <label class="amenity-option">
               <input type="checkbox" name="amenities" value="kitchen"> 
               <span>Kitchen</span>
            </label>
            <label class="amenity-option">
               <input type="checkbox" name="amenities" value="laundry"> 
               <span>Laundry</span>
            </label>
            <label class="amenity-option">
               <input type="checkbox" name="amenities" value="aircon"> 
               <span>Air Conditioning</span>
            </label>
         </div>
      </div>

      <input type="submit" value="Add Property" name="submit" class="btn">
   </form>
</section>

<script>
document.getElementById('addPropertyForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const amenities = [];
    
    // Get selected amenities
    document.querySelectorAll('input[name="amenities"]:checked').forEach(checkbox => {
        amenities.push(checkbox.value);
    });
    
    // Prepare data for API
const data = {
    title: formData.get('title'),
    address: formData.get('address'),
    room_type: formData.get('room_type'),
    price: parseFloat(formData.get('price')),  // This stays the same
    capacity: formData.get('capacity'),
    beds: formData.get('beds') ? parseInt(formData.get('beds')) : null,  // This stays the same
    contact_phone: formData.get('contact_phone'),
    description: formData.get('description'),
    amenities: amenities
};
    
    // Send to PHP backend
    fetch('http://localhost/boarding%20house%20finder/design/api/properties/create.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.message.includes('successfully')) {
            alert('Property added successfully!');
            window.location.href = 'properties.html';
        } else {
            alert('Error: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to add property. Please try again.');
    });
});
</script>

<script src="../js/script.js"></script>
</body>
</html>