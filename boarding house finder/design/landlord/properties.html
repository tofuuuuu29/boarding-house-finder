<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>My Properties</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
   <link rel="stylesheet" href="../css/style.css">
</head>
<body>
   
<header class="header">
   <nav class="navbar nav-1">
      <section class="flex">
         <a href="dashboard.html" class="logo"><i class="fas fa-house"></i>MyHome </a>
      </section>
   </nav>

   <nav class="navbar nav-2">
      <section class="flex">
         <div id="menu-btn" class="fas fa-bars"></div>
         <div class="menu">
            <ul>
               <li><a href="dashboard.html">Dashboard</a></li>
            </ul>
         </div>
         <ul>
            <li><a href="profile.html"><i class="fas fa-user"></i> John Doe</a></li>
            <li><a href="../index.html"><i class="fas fa-sign-out"></i> Logout</a></li>
         </ul>
      </section>
   </nav>
</header>

<!-- listings section starts  -->
<section class="listings">
   <h1 class="heading">My Properties</h1>
   <div style="text-align: center; margin-bottom: 2rem;">
      <a href="add-property.html" class="inline-btn">Add New Property</a>
   </div>

   <div id="myProperties" class="box-container">
      <!-- Properties will be loaded here -->
      <div class="loading">Loading your properties...</div>
   </div>
</section>

<script>
// Load landlord's properties
document.addEventListener('DOMContentLoaded', function() {
    fetch('../api/properties/my_properties.php')
        .then(response => response.json())
        .then(data => {
            if (data.message.includes('successfully')) {
                displayProperties(data.properties);
            } else {
                document.getElementById('myProperties').innerHTML = '<p>Error loading properties</p>';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('myProperties').innerHTML = '<p>Failed to load properties</p>';
        });
});

function displayProperties(properties) {
    const container = document.getElementById('myProperties');
    
    if (properties.length === 0) {
        container.innerHTML = `
            <div class="no-properties">
                <p>You haven't added any properties yet.</p>
                <a href="add-property.html" class="inline-btn">Add Your First Property</a>
            </div>
        `;
        return;
    }
    
    container.innerHTML = '';
    
    properties.forEach(property => {
        const propertyCard = `
            <div class="box">
                <div class="admin">
                    <h3>${property.title.charAt(0).toUpperCase()}</h3>
                    <div>
                        <p>${property.title}</p>
                        <span>${new Date(property.created_at).toLocaleDateString()}</span>
                    </div>
                </div>
                <div class="thumb">
                    <p class="type">
                        <span>${property.room_type}</span>
                        <span style="background-color: ${property.status === 'Available' ? '#28a745' : '#dc3545'}">
                            ${property.status}
                        </span>
                    </p>
                    <img src="../images/house-img-1.webp" alt="${property.title}">
                </div>
                <h3 class="name">${property.title}</h3>
                <p class="location"><i class="fas fa-map-marker-alt"></i><span>${property.address}, ${property.city}</span></p>
                <div class="flex">
                    <p><i class="fas fa-peso-sign"></i><span>â‚±${property.price}/month</span></p>
                    <p><i class="fas fa-user"></i><span>${property.capacity}</span></p>
                </div>
                <div class="flex">
                    <a href="edit-property.html?id=${property.id}" class="btn">Edit</a>
                    <a href="../view_property.html?id=${property.id}" class="btn">View</a>
                    <button onclick="deleteProperty(${property.id})" class="btn" style="background-color: #dc3545;">Delete</button>
                </div>
            </div>
        `;
        container.innerHTML += propertyCard;
    });
}

function deleteProperty(propertyId) {
    if (confirm('Are you sure you want to delete this property?')) {
        // We'll add delete functionality next
        alert('Delete functionality will be added in the next step');
    }
}
</script>

<script src="../js/script.js"></script>
</body>
</html>